<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrapper">
    <div class="tips">
      <p>Ấn vô đó đi</p>
    </br>
      <img src="./img/arrow-right.png" alt="">
    </div>
    <div class="box">
      <div class="circle">
        <div class="circle__text"><img id="box-img" src="./img/gift.png" alt=""></div>
      </div>
    </div>
      <div class="container">
        <div id="primary" class="spiner">

          <div class="spin-wrap">

              <!-- slide 1 -->
              <div class="content">
                <div class="box">
                  <div class="circle">
                    <div class="circle__text"><img src="./img/question.png" alt=""></div>
                  </div>
                </div>
                <div class="content__text">
                  <p class="question-text">- Câu hỏi trắc nghiệm -</p>
                  <p class="question-text">Hôm nay là ngày ?</p>
                  <div class="form" id="form-question">
                    <label for="date1" class="form-grp">
                      <input type="radio" name="date" id="date1">
                      <label for="date1"></label>
                    </label>
                    <label for="date2" class="form-grp">
                      <input type="radio" name="date" id="date2">
                      <label for="date2">Thứ Hai</label>
                    </label>
                    <label for="date3" class="form-grp">
                      <input type="radio" name="date" id="date3">
                      <label for="date3">Đầu Tuần</label>
                    </label>
                  </div>
                </div>
                <img class="content__bg" src="./img/gift.png" alt="">
              </div>

              <!-- slide 2 -->
              <div class="content">
                <div class="box">
                  <div class="circle">
                    <div class="circle__text"><p id="toggle-text">Happy <br>BirthDay</p></div>
                  </div>
                </div>
                <div class="content__text">
                  <div class="text-grp">
                    <div>HAPPY BIRTHDAY</div>
                    <span class="hpbd"></span>
                  </div>
                  <p>Text</p>
                </div>
                <img class="content__bg" src="./img/gift.png" alt="">
              </div>

              <!-- slide 3 -->
              <div class="content">
                <div class="box">
                  <div class="circle">
                    <div class="circle__text"><img src="./img/cake.png" alt=""></div>
                  </div>
                </div>
                <div class="content__text">
                  <p>Chọn 1 trong 3 hộp :></p>
                  <div class="content__gift">
                    <div class="content__gift-item">
                      <img class="box-gift" src="./img/giftbox.png" alt="">
                    </div>
                    <div class="content__gift-item">
                      <img class="box-gift" src="./img/giftbox.png" alt="">
                    </div>
                    <div class="content__gift-item">
                      <img class="box-gift" src="./img/giftbox.png" alt="">
                    </div>
                  </div>
                </div>
                <img class="content__bg" src="./img/gift.png" alt="">
              </div>
              <!-- .... 
                thêm slide copy từ <div class="content"> đến thẻ đóng, 
                qua css tăng slide = số lượng muốn thêm ( --slider: [số lượng muốn thêm]  )
              -->
              <!-- .... -->
          </div>
          <div class="btn">
            <img src="./img/nextbtn.png" alt="">
          </div>
          <div id="close-spin">
            <p>Đóng</p>
          </div>
        </div>
        <div class="img-cat">
          <img src="./img/cake.png" alt="ai ai ai">
        </div>
      </div>
      <div class="popup-gift">
        <div class="box">
          <div class="circle">
            <div class="circle__text"><img src="./img/hbd.png" alt=""></div>
          </div>
        </div>
        <div class="content__text">
          <p id="gift"></p>
        </div>
        <div class="popup-close">Đóng</div>
      </div>

      <audio id="beat" src="./img/hbd.mp3"></audio>
      <audio id="click" src="./img/click.mp3"></audio>
  </div>

  <script>
    var wrapper = document.querySelector('.wrapper');
    var beat = document.getElementById('beat');
    var click = document.getElementById('click');
    var content = document.querySelectorAll('.content');
    var boxGift = document.querySelectorAll('.box-gift');
    var primary = document.getElementById('primary');
    var toggleText = document.getElementById('toggle-text');
    var btnBox = document.querySelector('.box');
    var tips = document.querySelector('.tips')
    var btnNext = document.querySelector('.btn')
    
    var spin = document.querySelector('.spin-wrap')
    var cat = document.querySelector('.img-cat')

    var itemsGift = document.querySelectorAll('.content__gift-item');
    var textGift = document.getElementById('gift');
    var closeSpin = document.getElementById('close-spin');
    
    var popupGift = document.querySelector('.popup-gift')
    var popupClose = document.querySelector('.popup-close')
    var radio = document.querySelectorAll('input[name="date"]');
    var isCheck = false;
    
    var boxImg = document.getElementById('box-img');

    var giftArr = ["1 ly \"abc","1 ly \"def", "1 ly \"asd"]
    var ThamLamArr = ["aaaa","aaaab","aaaac"]
    var isGiftOpen = false;
    var checkActive = 0;
    var currentWidth = content[0].offsetWidth;

    radio.forEach(function(item) {
      item.onclick = function() {
        for(let i = 0; i < radio.length; i++) {
          if(radio[i].checked) {
            isCheck = true;
            break;
          }
        }
          if(isCheck) {
            btnNext.style = "left: 50%;";
            popupGift.style = "left: 50%; opacity: 1;"
            textGift.innerHTML = "aaa"
          } 
      }  
    }
    )

    closeSpin.onclick = function() {
      primary.style.top = '-100%';
    }
    
    popupClose.onclick = function() {
      popupGift.style = "left: -50%; opacity:0;"
    }
    itemsGift.forEach(function(item,index) {
        item.onclick = function() {
          // var x = document.querySelector('.content__gift-item.active')A
          // x.classList.remove('active');
          item.classList.add('active');
          boxGift[index].setAttribute('src','./img/present.png');
          for(let i = 0; i<itemsGift.length;i++) {
            if(itemsGift[i].classList.contains('active')) {
              checkActive++;
              if(checkActive == 1){
                popupGift.style = "left: 50%; opacity: 1;"
                textGift.textContent = "Hehe em đã nhận được "+giftArr[Math.floor(Math.random()*giftArr.length)].toString()+"\" từ anh. Qua dịch nhận e nhé, à mà khoan chụp màn hình lại gửi vào inbox để làm bằng chứng :>"
              }
              if(checkActive == 2) {
                isGiftOpen = true;
              }
            }
          }
          if(isGiftOpen) {
            popupGift.style = "left: 50%; opacity: 1;"
            textGift.textContent = ThamLamArr[Math.floor(Math.random()*ThamLamArr.length)].toString()
            // chặn lại dell cho mở nữa
          }
        }
        
    })

    // phần chuyển slide 
    var i = 0;
    var interval = null;
    btnNext.addEventListener('click', function() {
      click.play();
      popupGift.style = "left: -50%; opacity: 0;"

      i++;
      spin.style =  `left:-${currentWidth * i}px;`;
      if(i === content.length) {
        cat.style.display = 'flex';
        btnNext.style.display = 'none';
        i=-1;
        setTimeout(function(){
          cat.style.display = "none";
          btnNext.style.display = 'block';
          spin.style = `left:-${currentWidth * 2}px;`;
        },3000)
        setTimeout(function() { 
          closeSpin.style.left = "50%";
        },3000)
      }

      if(i==1) {
        interval = setInterval(function() {
          toggleText.classList.toggle('toggle-text');
        },500)
      }
      else clearInterval(interval);
    })
    
    btnBox.addEventListener('click',function() {
      beat.play();
      primary.style.top = '0';
      tips.classList.add('display-none');
      boxImg.setAttribute('src','./img/present.png')
    })
    beat.onpause = function() {
      beat.play();
    }
    
    function bubbles() {
      var count = 120;
      var i = 0;
      while(i < count) {
        var bubble = document.createElement('i');
        var x = Math.floor(Math.random() * wrapper.offsetWidth - 20);
        var y = Math.floor(Math.random() * wrapper.offsetHeight - 20);
        var size = Math.random() * 10;
        bubble.style.left = x+'px';
        bubble.style.top = y+'px';
        bubble.style.width = 10 + size + 'px';
        bubble.style.height = 10 + size + 'px';
        bubble.style.animationDuration = 5+size+'s';
        bubble.style.animationDelay = -size +'s';
        wrapper.appendChild(bubble);
        i++;
      }
    }
    bubbles();
  </script>
</body>
</html>